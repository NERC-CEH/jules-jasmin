<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
<head>
    <title>Majic | Map Data Viewer</title>

    <link href="/layout/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen" />
    <link href="/layout/joj.css" rel="stylesheet" media="screen" />
    <link href="/layout/sortable.css" rel="stylesheet" media="screen" />
    <link href="/layout/map.css" rel="stylesheet" />

    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery-sortable-min.js"></script>
    <script type="text/javascript" src="/layout/bootstrap/js/bootstrap.js"></script>
    <!--<script src="http://maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>-->
    <script type="text/javascript" src="http://openlayers.org/dev/OpenLayers.js"></script>
    <script type="text/javascript" src="/js/LoadingPanel.js"></script>
    <script type="text/javascript" src="/js/ecomaps_map.js"></script>
    <script type="text/javascript" src="/js/ecomaps_general.js"></script>
    <script type="text/javascript" src="/js/mapGraphing.js"></script>
    <script type="text/javascript" src="/js/flot/excanvas.js"></script>
    <script type="text/javascript" src="/js/flot/jquery.flot.js"></script>
    <script type="text/javascript" src="/js/flot/jquery.flot.navigate.js"></script>
    <script type="text/javascript" src="/js/flot/jquery.flot.time.js"></script>
    <script type="text/javascript" src="/js/flot/jquery.flot.axislabels.js"></script>
</head>
<body id="explore">
<div id="selected_id" style="display: none">${c.id}</div>
<div id="wrap">
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn pull-right" href="${h.url(controller='account', action='logout')}">Log out</a>
                <p id="status" class="navbar-text pull-right">
                    Map server status <span id="status-message" class="label">Testing...</span>
                </p>
                <a class="brand" href="${h.url(controller='home')}">Majic</a>

                <ul class="nav">
                    <li>
                        <a id="nav-explore" href="${h.url(controller='map', action='view')}">Explore</a>
                    </li>
                    <li>
                        <a id="nav-create" href="${h.url(controller='model_run', action='pre_create')}">New Model Run</a>
                    </li>
                    <li>
                        <a id="nav-catalogue" href="${h.url(controller='model_run')}">Model Runs</a>
                    </li>
                    <li>
                        <a id="nav-about" href="${h.url(controller='home', action='about')}">About</a>
                    </li>
                    <py:if test="c.admin_user">
                        <li class="dropdown">
                            <a id="nav-admin" data-toggle="dropdown" class="dropdown-toggle">
                                Admin Options
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="${h.url(controller='user')}">Users</a>
                                </li>
                                <li>
                                    <a href="${h.url(controller='dataset')}">Datasets</a>
                                </li>
                            </ul>
                        </li>
                    </py:if>
                </ul>
            </div>

        </div>
    </div>

    <div class="container-fluid">
        <div id="server-offline" class="alert alert-danger hide"><strong>Map Server Offline:</strong> Majic functionality will be reduced while the map server is offline.</div>
        <div class="row-fluid">
            <div class="span3">
                <h3>Visualise Model Runs</h3>
                <div class="sidebar-nav">
                    <ul class="nav nav-tabs">
                        <li py:for="model_run_sort in c.model_run_sorts" id="tab_${model_run_sort['name']}"
                            onclick="selectTab('${model_run_sort['name']}')" >
                            <a href="#" >
                                ${model_run_sort['name']}
                            </a>
                        </li>
                    </ul>
                    <div class="nav nav-list tab-pane" py:for="model_run_sort in c.model_run_sorts" id="pane_${model_run_sort['name']}">
                        <ul class="nav nav-list" py:for="model_run in model_run_sort['model_runs']">
                            <li class="nav-header">
                                <a href="#" onclick="expandCollapse('mod_hdr_${model_run.id}');return false" style="color:rgb(153,153,153)">
                                    ${model_run.name}<div id="mod_hdr_${model_run.id}_icon" style="display:inline"> +</div>
                                </a>
                            </li>
                            <div id="mod_hdr_${model_run.id}" style="display:none">
                                <ul class="nav nav-list">
                                    <li class="nav-header">
                                        <a href="#" onclick="expandCollapse('mod_ds_in_${model_run.id}');return false" style="color:rgb(153,153,153)">
                                            Input Datasets<div id="mod_ds_in_${model_run.id}_icon" style="display:inline"> +</div>
                                        </a>
                                    </li>
                                    <div id="mod_ds_in_${model_run.id}" class="nav nav-list" style="display:none">
                                        <li py:for="ds in model_run.datasets">
                                            <a py:if="ds.is_input == 1" class="dataset" href="#" data-dsid="${ds.id}">${ds.name}</a>
                                        </li>
                                    </div>
                                </ul>
                                <ul class="nav nav-list">
                                    <li class="nav-header">
                                        <a href="#" onclick="expandCollapse('mod_ds_out_${model_run.id}');return false" style="color:rgb(153,153,153)">
                                            Output Datasets<div id="mod_ds_out_${model_run.id}_icon" style="display:inline"> +</div>
                                        </a>
                                    </li>
                                    <div id="mod_ds_out_${model_run.id}" class="nav nav-list" style="display:none">
                                        <li py:for="ds in model_run.datasets">
                                            <a py:if="ds.is_input == 0" class="dataset" href="#" data-dsid="${ds.id}">${ds.name}</a>
                                        </li>
                                    </div>
                                </ul>
                            </div>
                        </ul>
                    </div>
                </div>

            </div>

            <div class="span9">
                <div id="map">
                    <div id="map-loading">
                        <p>Updating Map</p>
                    </div>
                    <div id="legend" class="hide">

                    </div>
                    <div class="pull-right hidden" id="options-panel">
                        <div id="layer-list" class="well sidebar-nav">

                            <button class="btn btn-mini" id="reset-button"><i class="icon-backward"></i> Reset</button>
                            <div id="dimension-panel" class="hidden">
                                <h5>Time controls</h5>
                                <ol class="sidebar-nav nopoints" id="dimension-list">

                                </ol>
                            </div>
                            <h5 id="map-title">Layers</h5>
                            <div id="layer-container">

                            </div>
                        </div>
                    </div>
                </div>
                <div id="graph" class="graph">
                    <p>Loading graph</p>
                </div>
            </div>
            <div class="pull-right" id="functions-panel">
                <div class="alert">
                    <a href="#image-panel" id="image-export"><i class="icon-share"></i> Export as image</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hide" id="analysis-detail"></div>
<div class="modal fade hide" id="image-panel">
    <div class="modal-body" id="image-panel-body">
        <p>Right-click and "Save As..." to save this image</p>
        <canvas id="map-canvas"></canvas>
    </div>
</div>
</body>
</html>
